import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
import { useEffect, useMemo, useState } from "react";
import "../Styles/dashboard.scss";
import "bootstrap/dist/js/bootstrap.bundle.min.js";
import { FiHome, FiCreditCard, FiUsers, FiLink, FiUser, FiSettings, FiBell, FiSearch, FiMoon, FiSun, FiMenu, FiLogOut, FiChevronDown, FiClock, } from "react-icons/fi";
import { useAuth } from "../../auth/hooks/useAuth";
import { logout } from "../../auth/services/auth.service";
/** Helpers */
const fmt = (v, currency = "HNL") => new Intl.NumberFormat("es-HN", { style: "currency", currency }).format(isFinite(v) ? v : 0);
const getInitials = (nameOrEmail) => {
    if (!nameOrEmail)
        return "US";
    const clean = nameOrEmail.split("@")[0];
    const parts = clean.trim().split(/\s+/);
    if (parts.length === 1)
        return parts[0].slice(0, 2).toUpperCase();
    return (parts[0][0] + parts[1][0]).toUpperCase();
};
const StatCard = ({ titulo, valor, auxiliar, tendencia, icono }) => (_jsxs("div", { className: "card stat h-100", children: [_jsx("div", { className: "stat-bg" }), _jsxs("div", { className: "card-body position-relative", children: [_jsx("div", { className: "icon-badge", children: icono }), _jsx("div", { className: "text-muted fw-semibold", children: titulo }), _jsxs("div", { className: "d-flex align-items-end gap-2 mt-1", children: [_jsx("div", { className: "value", children: valor }), auxiliar && _jsx("small", { className: "text-muted", children: auxiliar })] }), tendencia && (_jsx("div", { className: `mt-2 fw-bold trend ${tendencia.dir}`, children: tendencia.texto }))] })] }));
const RecentTable = () => {
    const rows = [
        { store: "Amazon", date: "2025-08-14", amount: 1290.5, status: "ok" },
        { store: "Ebay", date: "2025-08-12", amount: 470, status: "hold" },
        { store: "AliExpress", date: "2025-08-10", amount: 310.25, status: "fail" },
    ];
    return (_jsx("div", { className: "card table-card h-100", children: _jsxs("div", { className: "card-body", children: [_jsxs("div", { className: "d-flex align-items-center justify-content-between mb-2", children: [_jsx("h6", { className: "m-0 fw-bold", children: "Transacciones recientes" }), _jsx("a", { href: "#", className: "small", children: "Ver todo" })] }), _jsx("div", { className: "table-responsive", children: _jsxs("table", { className: "table align-middle", children: [_jsx("thead", { children: _jsxs("tr", { children: [_jsx("th", { children: "Tienda" }), _jsx("th", { children: "Fecha" }), _jsx("th", { children: "Monto" }), _jsx("th", { children: "Estado" }), _jsx("th", { className: "text-end", children: "Acci\u00F3n" })] }) }), _jsx("tbody", { children: rows.map((r, i) => (_jsxs("tr", { children: [_jsx("td", { className: "fw-semibold", children: r.store }), _jsx("td", { children: r.date }), _jsx("td", { children: fmt(r.amount) }), _jsx("td", { children: _jsx("span", { className: `status ${r.status}`, children: r.status === "ok"
                                                    ? "Pagado"
                                                    : r.status === "hold"
                                                        ? "Pendiente"
                                                        : "Fallido" }) }), _jsx("td", { className: "text-end", children: _jsx("button", { className: "btn btn-sm btn-light border", children: "Detalles" }) })] }, i))) })] }) })] }) }));
};
const Activity = () => (_jsx("div", { className: "card h-100", children: _jsxs("div", { className: "card-body", children: [_jsx("h6", { className: "fw-bold mb-3", children: "Actividad" }), _jsx("div", { className: "activity d-grid gap-3", children: [
                    { title: "Invitación enviada a Karen", time: "hace 3 min" },
                    { title: "Solicitud de retiro creada", time: "hace 1 h" },
                    { title: "Cupón canjeado en Nike", time: "Ayer" },
                ].map((a, i) => (_jsxs("div", { className: "item", children: [_jsx("div", { className: "dot" }), _jsxs("div", { children: [_jsx("div", { className: "fw-semibold", children: a.title }), _jsx("div", { className: "time", children: a.time })] })] }, i))) })] }) }));
const ThemeToggle = () => {
    const [theme, setTheme] = useState(() => (localStorage.getItem("theme") === "dark" ? "dark" : "light"));
    useEffect(() => {
        document.documentElement.setAttribute("data-theme", theme);
        localStorage.setItem("theme", theme);
    }, [theme]);
    const dark = theme === "dark";
    return (_jsxs("button", { className: "theme-toggle", onClick: () => setTheme(dark ? "light" : "dark"), "aria-label": "Cambiar tema", children: [dark ? _jsx(FiSun, {}) : _jsx(FiMoon, {}), " ", _jsx("span", { className: "d-none d-sm-inline", children: dark ? "Claro" : "Oscuro" })] }));
};
/** === PayPal Withdraw Widget (UI only) === */
const PaypalWithdrawWidget = () => {
    const [paypalEmail, setPaypalEmail] = useState("");
    const [fullName, setFullName] = useState("");
    const [currency, setCurrency] = useState("HNL");
    const [amountStr, setAmountStr] = useState("1500.00");
    const [note, setNote] = useState("");
    const [accept, setAccept] = useState(false);
    const amount = useMemo(() => Number(String(amountStr).replace(/[^\d.]/g, "")) || 0, [amountStr]);
    // Tasas de ejemplo (UI, no contractuales):
    // - Tarifa Swapp: 2%
    // - Tarifa PayPal estimada (ejemplo): 3.49% + 0.30 USD (si es USD)
    //   En HNL solo mostramos "estimado" (no calculamos fijo de 0.30 USD).
    const swappFee = amount * 0.02;
    const paypalPct = 0.0349;
    const paypalFixedUSD = 0.3;
    const paypalFee = currency === "USD" ? amount * paypalPct + paypalFixedUSD : amount * paypalPct;
    const totalFees = swappFee + paypalFee;
    const net = Math.max(0, amount - totalFees);
    const min = currency === "USD" ? 5 : 150; // solo UI
    const max = currency === "USD" ? 5000 : 120000; // solo UI
    return (_jsx("div", { className: "card withdraw h-100", children: _jsxs("div", { className: "card-body", children: [_jsxs("div", { className: "d-flex align-items-center justify-content-between mb-3", children: [_jsx("h5", { className: "fw-bold mb-0", children: "Retiro a PayPal" }), _jsxs("span", { className: "small text-muted d-inline-flex align-items-center gap-2", children: [_jsxs("svg", { width: "22", height: "22", viewBox: "0 0 24 24", "aria-hidden": "true", children: [_jsx("path", { fill: "#003087", d: "M20.4 4.5C19.2 2.8 16.9 2 13.9 2H7.8c-.5 0-1 .4-1.1.9L4 19.3c-.1.6.3 1.1.9 1.1h3.4l.3-1.9v.1c.1-.5.5-.9 1-.9h1.9c3.8 0 6.7-1.5 7.5-5.9.3-1.8.1-3.1-.5-4.3Z" }), _jsx("path", { fill: "#009CDE", d: "M21 9.4c-.9 4.4-3.8 5.9-7.5 5.9H11.7c-.5 0-.9.4-1 .9L10.4 21h3.1c.6 0 1.1-.4 1.2-1l.3-1.6c0-.1.1-.3.3-.3 2.5 0 4.4-1 5-3.9.2-1 .2-2 0-2.8Z" })] }), "PayPal (UI)"] })] }), _jsxs("div", { className: "alert alert-warning small", role: "alert", children: ["Este c\u00E1lculo es ", _jsx("strong", { children: "estimado" }), ". Las tarifas reales dependen de tu cuenta PayPal y pa\u00EDs. El retiro se procesa a la ", _jsx("strong", { children: "cuenta PayPal" }), " que indiques."] }), _jsxs("div", { className: "row g-3", children: [_jsx("div", { className: "col-lg-7", children: _jsxs("div", { className: "provider rounded-3", children: [_jsx("div", { className: "mb-2 fw-bold", children: "Detalles del retiro" }), _jsxs("div", { className: "mb-2", children: [_jsx("label", { className: "form-label small text-muted", children: "Nombre del titular (como aparece en PayPal)" }), _jsx("input", { className: "form-control", placeholder: "Ej. Juan P\u00E9rez", value: fullName, onChange: (e) => setFullName(e.target.value) })] }), _jsxs("div", { className: "mb-2", children: [_jsx("label", { className: "form-label small text-muted", children: "Correo de PayPal" }), _jsx("input", { className: "form-control", placeholder: "tu-correo@paypal.com", value: paypalEmail, onChange: (e) => setPaypalEmail(e.target.value) })] }), _jsxs("div", { className: "row g-2 mb-2", children: [_jsxs("div", { className: "col-7", children: [_jsx("label", { className: "form-label small text-muted", children: "Monto a retirar" }), _jsx("input", { className: "form-control", value: amountStr, onChange: (e) => setAmountStr(e.target.value) })] }), _jsxs("div", { className: "col-5", children: [_jsx("label", { className: "form-label small text-muted", children: "Moneda" }), _jsxs("select", { className: "form-select", value: currency, onChange: (e) => setCurrency(e.target.value), children: [_jsx("option", { value: "HNL", children: "HNL" }), _jsx("option", { value: "USD", children: "USD" })] })] })] }), _jsxs("div", { className: "mb-3", children: [_jsx("label", { className: "form-label small text-muted", children: "Nota (opcional)" }), _jsx("input", { className: "form-control", placeholder: "Mensaje para el retiro", value: note, onChange: (e) => setNote(e.target.value) })] }), _jsxs("div", { className: "d-flex align-items-center justify-content-between", children: [_jsxs("div", { children: [_jsx("div", { className: "small text-muted", children: "Comisiones estimadas" }), _jsxs("div", { className: "fw-bold", children: [fmt(totalFees, currency), " ", _jsxs("small", { className: "text-muted", children: ["(", fmt(swappFee, currency), " Swapp + ", fmt(paypalFee, currency), " PayPal)"] })] })] }), _jsx("button", { className: "btn btn-withdraw px-4", disabled: !accept, children: "Solicitar retiro" })] }), _jsxs("div", { className: "form-check mt-3", children: [_jsx("input", { className: "form-check-input", type: "checkbox", id: "acceptFees", checked: accept, onChange: (e) => setAccept(e.target.checked) }), _jsx("label", { className: "form-check-label small text-muted", htmlFor: "acceptFees", children: "Acepto las tarifas estimadas y pol\u00EDticas de retiro." })] })] }) }), _jsx("div", { className: "col-lg-5", children: _jsxs("div", { className: "p-3 rounded-3 h-100", children: [_jsx("div", { className: "fw-bold mb-2", children: "Requisitos y reglas (PayPal)" }), _jsxs("div", { className: "rule mb-2", children: [_jsx("div", { className: "fw-bold", children: fmt(min, currency) }), _jsx("small", { children: "Monto m\u00EDnimo por retiro" })] }), _jsxs("div", { className: "rule mb-2", children: [_jsx("div", { className: "fw-bold", children: fmt(max, currency) }), _jsx("small", { children: "Monto m\u00E1ximo por retiro" })] }), _jsxs("div", { className: "rule mb-2", children: [_jsx("div", { className: "fw-bold", children: "Cuenta verificada" }), _jsx("small", { children: "Tu cuenta PayPal debe estar activa y verificada." })] }), _jsxs("div", { className: "rule mb-2", children: [_jsx("div", { className: "fw-bold", children: "2\u201372 h" }), _jsx("small", { children: "Tiempo de acreditaci\u00F3n estimado" })] }), _jsxs("div", { className: "rule", children: [_jsx("div", { className: "fw-bold", children: "Monedas" }), _jsx("small", { children: "Procesamos HNL y USD (seg\u00FAn disponibilidad de tu cuenta)." })] }), _jsx("hr", {}), _jsxs("div", { className: "d-flex align-items-center justify-content-between", children: [_jsxs("div", { children: [_jsx("div", { className: "small text-muted", children: "Recibir\u00E1s aprox." }), _jsx("div", { className: "fw-bold", children: fmt(net, currency) })] }), _jsx("button", { className: "btn btn-outline-secondary", children: "Conectar PayPal" })] }), _jsx("div", { className: "small text-muted mt-2", children: "* La conversi\u00F3n de moneda (si aplica) y la tarifa fija de PayPal pueden variar seg\u00FAn pa\u00EDs/cuenta." })] }) })] })] }) }));
};
/** === Page === */
const DashboardPage = () => {
    const { user } = useAuth();
    const display = user?.displayName || user?.email || "Usuario";
    const initials = getInitials(display);
    const avatarUrl = user?.photoURL ?? "";
    return (_jsx("div", { className: "client-dashboard", children: _jsxs("div", { className: "dash-grid", children: [_jsxs("aside", { className: "sidebar d-none d-lg-flex", children: [_jsxs("div", { className: "brand", children: [_jsx("span", { className: "dot" }), _jsx("span", { className: "brand-text", children: "Swapp" })] }), _jsxs("nav", { className: "nav flex-column", children: [_jsxs("a", { className: "nav-link active", href: "#", children: [_jsx(FiHome, {}), _jsx("span", { children: "Panel" })] }), _jsxs("a", { className: "nav-link", href: "#", children: [_jsx(FiCreditCard, {}), _jsx("span", { children: "Retiros" })] }), _jsxs("button", { className: "nav-link nav-link-btn", "data-bs-toggle": "collapse", "data-bs-target": "#subHistorial", "aria-expanded": "false", "aria-controls": "subHistorial", type: "button", children: [_jsx(FiClock, {}), _jsx("span", { children: "Historial" }), _jsx(FiChevronDown, { className: "caret" })] }), _jsx("div", { id: "subHistorial", className: "collapse", children: _jsxs("div", { className: "nav-sub", children: [_jsx("a", { className: "nav-sublink", href: "#", children: _jsx("span", { children: "Historial de puntos" }) }), _jsx("a", { className: "nav-sublink", href: "#", children: _jsx("span", { children: "Historial de canjes" }) })] }) })] }), _jsx("div", { className: "mt-auto p-3", children: _jsxs("button", { className: "btn btn-outline-danger w-100 d-flex align-items-center justify-content-center gap-2", onClick: logout, children: [_jsx(FiLogOut, {}), " Cerrar sesi\u00F3n"] }) })] }), _jsxs("div", { className: "main", children: [_jsxs("header", { className: "topbar", children: [_jsx("button", { className: "hamburger d-lg-none", "data-bs-toggle": "offcanvas", "data-bs-target": "#sbOff", "aria-label": "Abrir men\u00FA", children: _jsx(FiMenu, {}) }), _jsxs("div", { className: "search input-group", children: [_jsx("span", { className: "input-group-text border-0", children: _jsx(FiSearch, {}) }), _jsx("input", { className: "form-control", placeholder: "Buscar tiendas, cupones\u2026" })] }), _jsx(ThemeToggle, {}), _jsx("button", { className: "btn btn-light border rounded-circle p-2", "aria-label": "Notificaciones", children: _jsx(FiBell, {}) }), _jsxs("div", { className: "user dropdown", children: [_jsx("button", { className: "btn p-0 dropdown-toggle user-toggle", "data-bs-toggle": "dropdown", "aria-expanded": "false", children: avatarUrl ? (_jsx("img", { className: "avatar-img", src: avatarUrl, alt: display })) : (_jsx("div", { className: "avatar", children: initials })) }), _jsxs("div", { className: "dropdown-menu dropdown-menu-end user-menu", children: [_jsxs("div", { className: "user-header", children: [_jsx("div", { className: "u-name", children: display }), _jsx("div", { className: "u-email", children: user?.email })] }), _jsxs("button", { className: "dropdown-item", children: [_jsx(FiUser, {}), " Mi perfil"] }), _jsxs("button", { className: "dropdown-item", children: [_jsx(FiUsers, {}), " Mis amigos"] }), _jsxs("button", { className: "dropdown-item", children: [_jsx(FiSettings, {}), " Configuraci\u00F3n"] }), _jsx("div", { className: "dropdown-divider" }), _jsxs("button", { className: "dropdown-item text-danger", onClick: logout, children: [_jsx(FiLogOut, {}), " Cerrar sesi\u00F3n"] })] })] })] }), _jsxs("section", { className: "content", children: [_jsxs("div", { className: "row g-3 mb-3", children: [_jsx("div", { className: "col-12 col-sm-6 col-xl-3", children: _jsx(StatCard, { titulo: "Saldo", valor: fmt(2580.75), auxiliar: "Disponible", icono: _jsx(FiCreditCard, {}) }) }), _jsx("div", { className: "col-12 col-sm-6 col-xl-3", children: _jsx(StatCard, { titulo: "Este mes", valor: fmt(842.1), tendencia: { dir: "up", texto: "+12.2%" }, icono: _jsx(FiUsers, {}) }) }), _jsx("div", { className: "col-12 col-sm-6 col-xl-3", children: _jsx(StatCard, { titulo: "Pendiente", valor: fmt(150), tendencia: { dir: "down", texto: "-3.8%" }, icono: _jsx(FiLink, {}) }) }), _jsx("div", { className: "col-12 col-sm-6 col-xl-3", children: _jsx(StatCard, { titulo: "Retiros", valor: "8", auxiliar: "\u00FAltimos 30 d\u00EDas", icono: _jsx(FiHome, {}) }) })] }), _jsxs("div", { className: "row g-3 mb-3", children: [_jsx("div", { className: "col-12 col-xl-7", children: _jsx(PaypalWithdrawWidget, {}) }), _jsx("div", { className: "col-12 col-xl-5", children: _jsx(Activity, {}) })] }), _jsx("div", { className: "row g-3", children: _jsx("div", { className: "col-12", children: _jsx(RecentTable, {}) }) })] })] }), _jsx("aside", { id: "sbOff", className: "offcanvas offcanvas-start sidebar d-lg-none", children: _jsxs("div", { className: "offcanvas-body p-0 d-flex flex-column", children: [_jsxs("div", { className: "brand", children: [_jsx("span", { className: "dot" }), _jsx("span", { className: "brand-text", children: "Swapp" })] }), _jsxs("nav", { className: "nav flex-column", children: [_jsxs("a", { className: "nav-link active", "data-bs-dismiss": "offcanvas", href: "#", children: [_jsx(FiHome, {}), _jsx("span", { children: "Panel" })] }), _jsxs("a", { className: "nav-link", "data-bs-dismiss": "offcanvas", href: "#", children: [_jsx(FiCreditCard, {}), _jsx("span", { children: "Retiros" })] }), _jsxs("button", { className: "nav-link nav-link-btn", "data-bs-toggle": "collapse", "data-bs-target": "#subHistorialM", "aria-expanded": "false", "aria-controls": "subHistorialM", type: "button", children: [_jsx(FiClock, {}), _jsx("span", { children: "Historial" }), _jsx(FiChevronDown, { className: "caret" })] }), _jsx("div", { id: "subHistorialM", className: "collapse", children: _jsxs("div", { className: "nav-sub", children: [_jsx("a", { className: "nav-sublink", "data-bs-dismiss": "offcanvas", href: "#", children: _jsx("span", { children: "Historial de puntos" }) }), _jsx("a", { className: "nav-sublink", "data-bs-dismiss": "offcanvas", href: "#", children: _jsx("span", { children: "Historial de canjes" }) })] }) })] })] }) })] }) }));
};
export default DashboardPage;
